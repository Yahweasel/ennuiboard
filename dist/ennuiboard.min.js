var Ennuiboard=function(){"use strict";
/*!
     * Copyright (c) 2019-2024 Yahweasel
     *
     * Permission to use, copy, modify, and/or distribute this software for any
     * purpose with or without fee is hereby granted, provided that the above
     * copyright notice and this permission notice appear in all copies.
     *
     * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
     * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
     * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
     * SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
     * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
     * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
     * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
     */var t=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(a,i){function o(t){try{u(s.next(t))}catch(t){i(t)}}function r(t){try{u(s.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}u((s=s.apply(t,e||[])).next())}))};const e={subsystems:{},supported:{any:!1},enabled:{any:!1},enabling:{},requiresPermissions:{},enable:function(e){return t(this,arguments,void 0,(function*(e,n={}){if(!this.supported[e])return Promise.resolve(!1);if(this.enabling[e])return this.enabling[e];return this.enabling[e]=(()=>t(this,void 0,void 0,(function*(){const t=yield this.subsystems[e].enable(n);if(!t)return t;if(n.auto&&"undefined"!=typeof localStorage){let t={};const s=localStorage.getItem("eb-auto");s&&(t=JSON.parse(s)),t[e]=n,localStorage.setItem("eb-auto",JSON.stringify(t))}})))()}))},disable:function(t){if("undefined"==typeof localStorage)return;var e=localStorage.getItem("eb-auto");if(!e)return;const n=JSON.parse(e);delete n[t],0===Object.keys(n).length?localStorage.removeItem("eb-auto"):localStorage.setItem("eb-auto",JSON.stringify(n))}};function n(t,e){var n=new KeyboardEvent("key"+t,{key:e,bubbles:!0});(document.activeElement||document.body).dispatchEvent(n)}e.subsystems.gamepad={requiresPermissions:!1,supported:function(){return!(!navigator.getGamepads&&!navigator.webkitGetGamepads)},enable:function(t={}){return navigator.getGamepads?(this._getGamepads=navigator.getGamepads.bind(navigator),this._queryButton=this._standardQueryButton):(this._getGamepads=navigator.webkitGetGamepads.bind(navigator),this._queryButton=this._webkitQueryButton),t.manualPoll||(this._interval=setInterval(this.poll.bind(this),50)),e.enabled.gamepad=e.enabled.any=!0,Promise.resolve(!0)},_state:{},poll:function(){let t=this._getGamepads();for(let e=0;e<t.length;e++){let s=t[e];if(!s)continue;s.id in this._state||(this._state[s.id]={});let a=this._state[s.id];for(let t=0;t<s.buttons.length;t++){const e="b"+t;e in a||(a[e]=!1);const i=this._queryButton(s.buttons[t]);i!==a[e]&&(n(i?"down":"up","eb:gamepad:"+s.id+":"+e),a[e]=i)}for(let t=0;t<s.axes.length;t++){const e="a"+t;e in a||(a[e]=0);const i=~~Math.round(s.axes[t]);if(i!==a[e]){const t="eb:gamepad:"+s.id+":"+e;if(a[e]){n("up",t+(a[e]>0?"+":"-"))}if(i){n("down",t+(i>0?"+":"-"))}a[e]=i}}}},_standardQueryButton:function(t){return t.value>0||t.pressed},_webkitQueryButtons:function(t){return t>0}},e.subsystems.midi={requiresPermissions:!0,supported:function(){return!!navigator.requestMIDIAccess},_state:{},enable:function(){return t(this,arguments,void 0,(function*(t={}){try{return(yield navigator.requestMIDIAccess()).inputs.forEach(((t,e)=>{let s=this._state[e]={};t.addEventListener("midimessage",(t=>{if(!t.data||t.data.length<3)return;let a=null,i=240&t.data[0];if(144===i?a=t.data[2]?"down":"up":128===i&&(a="up"),!a)return;let o=(15&t.data[0])+":"+t.data[1];o in s||(s[o]="up"),a!==s[o]&&(n(a,"eb:midi:"+e+":"+o),s[o]=a)}))})),!0}catch(t){return!1}}))}};for(const t of["gamepad","midi"])(e.supported[t]=e.subsystems[t].supported())&&(e.supported.any=!0),e.requiresPermissions[t]=e.subsystems[t].requiresPermission;if("undefined"!=typeof localStorage){let t=localStorage.getItem("eb-auto");t||(t="{}");const n=JSON.parse(t);for(const t of Object.keys(n).sort())n[t]&&e.enable(t,n[t])}return e}();
