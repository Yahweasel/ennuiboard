var Ennuiboard=function(t){"use strict";
/*!
     * Copyright (c) 2019-2024 Yahweasel
     *
     * Permission to use, copy, modify, and/or distribute this software for any
     * purpose with or without fee is hereby granted, provided that the above
     * copyright notice and this permission notice appear in all copies.
     *
     * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
     * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
     * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
     * SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
     * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
     * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
     * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
     */var e=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,a){function o(t){try{u(s.next(t))}catch(t){a(t)}}function r(t){try{u(s.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}u((s=s.apply(t,e||[])).next())}))};const n={subsystems:{},supported:{any:!1},enabled:{any:!1},enabling:{},requiresPermission:{},enable:function(t){return e(this,arguments,void 0,(function*(t,n={}){if(!this.supported[t])return Promise.resolve(!1);if(this.enabling[t])return this.enabling[t];return this.enabling[t]=(()=>e(this,void 0,void 0,(function*(){const e=yield this.subsystems[t].enable(n);if(!e)return e;if(n.auto&&"undefined"!=typeof localStorage){let e={};const s=localStorage.getItem("eb-auto");s&&(e=JSON.parse(s)),e[t]=n,localStorage.setItem("eb-auto",JSON.stringify(e))}return!0})))()}))},disable:function(t){if("undefined"==typeof localStorage)return;var e=localStorage.getItem("eb-auto");if(!e)return;const n=JSON.parse(e);delete n[t],0===Object.keys(n).length?localStorage.removeItem("eb-auto"):localStorage.setItem("eb-auto",JSON.stringify(n))}};function s(t,e){var n=new KeyboardEvent("key"+t,{key:e,bubbles:!0});(document.activeElement||document.body).dispatchEvent(n)}const i={requiresPermission:!1,supported:function(){return!!navigator.getGamepads},enable:function(t={}){return t.manualPoll||(this._interval=setInterval(this.poll.bind(this),50)),n.enabled.gamepad=n.enabled.any=!0,Promise.resolve(!0)},_interval:0,_bstate:{},_astate:{},poll:function(){let t=navigator.getGamepads();for(let e=0;e<t.length;e++){let n=t[e];if(!n)continue;n.id in this._bstate||(this._bstate[n.id]={},this._astate[n.id]={});const i=this._bstate[n.id],a=this._astate[n.id];for(let t=0;t<n.buttons.length;t++){const e="b"+t;e in i||(i[e]=!1);const a=this._queryButton(n.buttons[t]);a!==i[e]&&(s(a?"down":"up","eb:gamepad:"+n.id+":"+e),i[e]=a)}for(let t=0;t<n.axes.length;t++){const e="a"+t;e in a||(a[e]=0);const i=~~Math.round(n.axes[t]);if(i!==a[e]){const t="eb:gamepad:"+n.id+":"+e;if(a[e]){s("up",t+(a[e]>0?"+":"-"))}if(i){s("down",t+(i>0?"+":"-"))}a[e]=i}}}},_queryButton:function(t){return t.value>0||t.pressed}};n.subsystems.gamepad=i;const a={requiresPermission:!0,supported:function(){return!!navigator.requestMIDIAccess},_state:{},enable:function(){return e(this,arguments,void 0,(function*(t={}){try{return(yield navigator.requestMIDIAccess()).inputs.forEach(((t,e)=>{let n=this._state[e]={};t.addEventListener("midimessage",(t=>{if(!t.data||t.data.length<3)return;let i=null,a=240&t.data[0];if(144===a?i=t.data[2]?"down":"up":128===a&&(i="up"),!i)return;let o=(15&t.data[0])+":"+t.data[1];o in n||(n[o]="up"),i!==n[o]&&(s(i,"eb:midi:"+e+":"+o),n[o]=i)}))})),!0}catch(t){return!1}}))},poll:function(){}};n.subsystems.midi=a;for(const t of["gamepad","midi"])(n.supported[t]=n.subsystems[t].supported())&&(n.supported.any=!0),n.requiresPermission[t]=n.subsystems[t].requiresPermission;if("undefined"!=typeof localStorage){let t=localStorage.getItem("eb-auto");t||(t="{}");const e=JSON.parse(t);for(const t of Object.keys(e).sort())e[t]&&n.enable(t,e[t])}return t.Ennuiboard=n,t}({});
